{%extends 'main/layout.html'%}
{% load static %}
{% block head %}
    <link rel="stylesheet" type="text/css" href="{% static 'companies/css/companies.css'%}">
    <link rel="stylesheet" type="text/css" href="{% static 'main/css/categories.css'%}">
{% endblock %}

{%block title%}Компании{%endblock%}
{%block content%}

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<main class="companies">
    {% for company in companies %}
        <div class="companies-item company {{company.type_id}}">
            <div class="company-item_main">

                <div class="companies-item_left">
                    <span class="companies-item-title">{{ company.name }}</span>
                    <a class="companies-item_link" href="{{company.url}}">
                         <img class="companies-item_link-img" src="{{ company.logotype.url }}">
                    </a>

                </div>

                <div class="companies-item_description">

                  <!--  <div class="companies-item-tags">
                        <span class="companies-item-tag">Frontend</span>
                        <span class="companies-item-tag">1C</span>
                        <span class="companies-item-tag">BI</span>
                        <span class="companies-item-tag">Android</span>
                    </div> -->
                    <span class="companies-item_about-company">{{company.short_description}}</span>
                </div>
            </div>


            <div class="companies-item_footer">
                <a class="companies-item_footer-link" href="{{company.url}}">
                    <img class="companies-item_link-icon" src="{% static 'companies/icons/url.svg'%}">
                    <span class="companies-item_link-text">{{ company.name }}</span>
                </a>
                {% if user.is_authenticated %}
                    <button id="add-to-favorites-{{ company.id }}" data-company-id="{{ company.id }}" class="companies-item_fav-button">
                        <img class="fav-button_icon" src="{% static 'companies/icons/heart.svg'%}">
                        <span>Избранное</span>
                    </button>
                {% endif %}

            </div>
        </div>
    {% endfor%}
</main>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.companies-item_fav-button').forEach(function (button) {
            button.addEventListener('click', function () {
                const companyId = button.getAttribute('data-company-id');
                addToFavorites(companyId);
            });
        });

        function addToFavorites(companyId) {
            fetch(`add_to_favorites/${companyId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'added') {
                    alert('Компания добавлена в избранное!');
                } else if (data.status === 'already_exists') {
                    alert('Компания уже в избранном!');
                }
            })
            .catch(error => console.error('Error:', error));
        }

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }
    });
</script>
{%endblock%}
